'use strict'
const crypto = require('crypto')
const fs = require('fs')
const { move } = require('piscina')

module.exports = (task) => {
  const results = task.map((filePath) => {
    try {
      const { mode, size } = fs.statSync(filePath)
      const file = fs.readFileSync(filePath)
      const hash = crypto.createHash('md5').update(file).digest('hex')

      return { filePath, mode, size, hash, file }
    } catch (err) {
      if (err.code === 'ENOENT') {
        return { filePath }
      }
      throw err
    }
  })
  return move(results)
}
