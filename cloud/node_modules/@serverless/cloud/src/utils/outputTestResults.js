module.exports = (cli, event) => {
  const { results, message, error, test_time_ms } = event.data.object
  const took = test_time_ms ? cli.styles.dim(`(${test_time_ms / 1000}s)`) : ''

  if (error) {
    cli.log(error)
  }

  if (message) {
    cli.log(message)
  }

  if (results) {
    if (results.success) {
      cli.logSuccess(`${results.numPassedTests}/${results.numTotalTests} tests passed ${took}`)
    } else {
      cli.logError(`${results.numFailedTests}/${results.numTotalTests} tests failed ${took}`)
    }
    cli.log()
    for (const result of results.testResults) {
      cli.log(`${result.name.replace(/\/(var|tmp)\/task\//, '')}`, 2)
      cli.log()

      if (result.status === 'failed') {
        cli.log(result.message)
      } else {
        for (let assertionResult of result.assertionResults) {
          if (assertionResult.status === 'failed') {
            cli.logError(assertionResult.title, 4)
            cli.log()
            for (let failureMessage of assertionResult.failureMessages) {
              for (let line of failureMessage.split('\n')) {
                cli.log(line, 6)
              }
            }
            cli.log()
          } else {
            cli.logSuccess(cli.styles.dim(assertionResult.title), 4)
          }
        }
      }
      cli.log()
    }
    process.exitCode = results.success ? 0 : 1
  }
}
