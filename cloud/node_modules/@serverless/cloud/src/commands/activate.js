'use strict'

const User = require('../models/User')
const Org = require('../models/Org')

const activate = async (cli) => {
  cli.viewSpinner()

  const user = new User()

  const orgName = cli.options.org

  const org = new Org({ user, orgName })

  let activationCode = cli.args[0] || cli.options.activate

  if (!activationCode) {
    activationCode = await cli.prompt('type your access code')
  }

  try {
    cli.viewSpinner('Activating')
    await org.authorize({ activationCode: activationCode.toUpperCase() })
  } catch (e) {
    if (e.message.includes('Access code does not exist')) {
      cli.logError('Your access code is invalid. Please try again.')
      return await activate(cli)
    }
    throw e
  }

  cli.logSuccess('Welcome to Serverless Cloud!')
}

module.exports = activate
